

<script>
//SET Z-INDEX OF PANELS
const panels = gsap.utils.toArray(".panel-section");
gsap.set(panels, {zIndex: (i, target, targets) => targets.length - i});

//INTRODUCTION SECTION PARTICLES
// Create temp variable to extract RGB values for scene
let tempColor = new THREE.Color().setHex( 0x1d2732 )
let scene, camera, renderer, stars, starGeo;
let introSec = document.getElementById('particles-js');
function init() {

  scene = new THREE.Scene();
  scene.background = new THREE.Color( 0x0D1318 );
  //check screen size
  camera = new THREE.PerspectiveCamera(60,window.innerWidth / window.innerHeight, 1, 1000);
  camera.position.z = 1;
  camera.rotation.x = Math.PI/2;

  renderer = new THREE.WebGLRenderer();
  renderer.setClearColor( 0xffffff, 0);
  renderer.setSize(window.innerWidth, window.innerHeight);
  introSec.appendChild(renderer.domElement);


  starGeo = new THREE.Geometry();
  for(let i=0;i<6000;i++) {
    star = new THREE.Vector3(
      Math.random() * 600 - 300,
      Math.random() * 600 - 300,
      Math.random() * 600 - 300
    );
    star.velocity = 0;
    //make acceleration zero to control particle movement
    star.acceleration = 0;
    starGeo.vertices.push(star);
  }
  let sprite = new THREE.TextureLoader().load( 'https://uploads-ssl.webflow.com/614716810b4f493df1dcfca4/61474f91d12a71efed96e0df_star.png' );
  let starMaterial = new THREE.PointsMaterial({
    color: 0xaaaaaa,
    size: 2,
    map: sprite,
    sizeAttenuation: false
  });

  stars = new THREE.Points(starGeo,starMaterial);
  scene.add(stars);

  window.addEventListener("resize", onWindowResize, false);

  animate(); 
}
function onWindowResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  }
function animate() {
  starGeo.vertices.forEach(p => {
    p.velocity += p.acceleration
    p.y -= p.velocity;
    
    if (p.y < -200) {
      p.y = 200;
      p.velocity = 0;
    }
  });
  starGeo.verticesNeedUpdate = true;
  // stars.rotation.y +=0.002;

  renderer.render(scene, camera);
  requestAnimationFrame(animate);
}

init();

function namePage(pg, col='') {
  let sections = document.querySelector(pg)
  let thePage = sections.dataset.page;
  let colorOrder, newIndex;
  if(thePage == undefined){
    pageTitle.innerHTML = ''
  }else{
    pageTitle.innerHTML = thePage
  }
  //reset color array
  if(col==''){
    colorOrder = [...colorPatch]
  }else{
    newIndex = colorPatch.indexOf(col)
    colorOrder = [...colorPatch.slice(newIndex), ...colorPatch.slice(0, newIndex)]
  }
  //rotate menu
  for(let i=0; i<menuList.length-1; i++) {
    menuList[i].style.borderTopColor = colorOrder[i]
  };
}

//register gsap scroll plugin
gsap.registerPlugin(ScrollTrigger);
gsap.registerPlugin(TextPlugin);
gsap.registerPlugin(CSSPlugin);

ScrollTrigger.defaults({
  ease: Power1.easeOut

});

//PARTICLES ON SCROLL  
let particle_anim = gsap.timeline()
  particle_anim.to(starGeo.vertices, {
  y: 50,
    ease: "power1.inOut", scrollTrigger: {    
    trigger: ".intro-section",
    scrub: true,
  }})
 
let points = gsap.utils.toArray(".panel-section");
let height = 100 * points.length;

//INTRODUCTION ON SCROLL
let paras = gsap.utils.toArray('.introtext')
let introTl = gsap.timeline({
  scrollTrigger: {
    trigger:".container",
    start: "top top",
    scrub: 2,//move 10s afetr scroll
    pin: true,
    end: "+=" + height + "%",
    // pinSpacing: false,
    //onEnter: () => namePage('.intro-section', '#5c5cf2'),
    //onEnterBack: () => namePage('.intro-section', '#5c5cf2'),
  }
  
})
introTl.to('.introtext',
  {opacity:1, duration:0.1}
)
for(let i=0; i<paras.length; i++){
  introTl.from(paras[i],{
    scale:0,     
    duration:400,
    delay:2
  })
  introTl.to(paras[i],{
     scale:0.9,
     duration:50,
   })
  introTl.to(paras[i],{
    opacity:0,
    duration:10,
  })
}
introTl.to(scene.background, {
  r: tempColor.r, g: tempColor.g, b: tempColor.b }, "-=550");
introTl.to(".intro-section",
      { duration: 10.0,opacity: 0, visibility:"hidden"}, "<"
    );
 introTl.to(".meditate-section",
      { duration: 10.0,opacity: 1}
    , "<");

//MEDITATE SECTION
  introTl.from('.meditate-text', {yPercent: 50,
    opacity:0.6,
    duration:125,
  }, "<")
  introTl.to('.skip',
  {opacity:0},"-=5"
  )
  introTl.from('.atoms', {
    duration:125,
    opacity:0,
    scale:0,
    
  })
  introTl.from('.meditate', {
    opacity:0,
    scale:0,
    duration:125,
    
  }, "-=1")
  introTl.from('.large-atom', {
    opacity:0,
    scale:0,
    duration:125,
    
  })
  introTl.from('.atoms', 
    {xPercent:6,
    duration:15,
    ease:"bounce",
  })
  introTl.from('.meditate', 
    {xPercent:2,
    duration:15,
    ease:"bounce",
  }, "<")
introTl.to(".meditate-section",
      { duration: 120.0,backgroundColor: "transparent"}
    );
introTl.to(".meditate-section",
      { duration: 120.0,yPercent: -100}, "<"
    );
    
introTl.to(".meditate-section",
      { duration: 120.0,opacity: 0}, "<"
    );
//  introTl.to(".meditate-section",
//       { duration: 60.0,autoAlpha: 1}
//     );
 introTl.to(".moon-section",
      { duration: 120.0,opacity: 1}
    , "<");
  introTl.from('.full-moon-text1', {
    yPercent:50, duration:120
  },"<")

  
  introTl.from('.full-moon1', 
  {duration:125, delay:50, opacity:0})
  introTl.to('.moon-text-one', 
  {yPercent:-100, duration:125})
  introTl.to('.large-moon', {
    background: "radial-gradient(circle at 50% 50%, rgb(24, 19, 39) 53%, rgb(103, 82, 167) 100%, rgb(160, 128, 255))", 
    duration:125
  },"<2")
  introTl.to('.moon-text-one', 
  {opacity:0}, "<")
  //introTl.to('.moon-text-one', 
  //{autoAlpha:1, duration:125}, "-=2")
  introTl.fromTo('.full-moon-text2', {opacity:0, yPercent:100},
  {opacity:1, yPercent:0, duration:125}, "<")
  introTl.fromTo('.full-moon2', {opacity:0},{opacity:1}, "<")
  introTl.to('.moon-text-two',
  {yPercent:-100, duration:400})
  introTl.to('.moon-text-two',
  {opacity:0})
  introTl.to('.moon-section',
  {opacity:0.5, duration: 125})
  introTl.to('.today-section',
  {opacity:0.5, duration: 125})
  introTl.from('.side-circle', {opacity:0})
  introTl.to('.moon-section',
  {opacity:0, visibility: "hidden"})
  introTl.from('.today-text-wrapper', {opacity:0, duration:125})
  introTl.from( '.inner-sphere' ,{ 
    rotation: "90_cw", duration:125 });
  introTl.from('.today-text', {opacity:0},"<5")
  introTl.to('.today-text', {yPercent: -150, duration:125})
  introTl.fromTo('.tomorrow-text', {opacity:0, yPercent: 100},{opacity:1, duration:125})
  introTl.to('.today-text', {opacity:0, visibility: "hidden"}, "<")
  introTl.to( '.inner-sphere' ,{ 
    rotation: "270_ccw", duration:125 }, "<80");
  introTl.fromTo('.tomorrow', {opacity:0},{opacity:1, duration:60}, "<")
  introTl.fromTo('.today', {opacity:1},{opacity:0, duration:60})
  introTl.to('.tomorrow-text', {yPercent: -150})
  introTl.to('.tomorrow-text', {opacity:0, visibility: "hidden"})
  introTl.to('.side-circle', {
    boxShadow: "0 0 0 0 transparent", duration:10
  })
  introTl.to('.today-section-wrap', {yPercent: -100, duration:120})
  introTl.to('.today-section', {opacity: 0, duration:60}, "<60")
  introTl.to('.today-section', {visibility: "hidden", duration:30})
  // introTl.to('.rotate-tomorrow', {xPercent: 200, duration:120}, "<")
  // introTl.to('.story-wrapper, .rotate-tomorrow', {opacity:0, duration:60})
  introTl.to('.globe-section', {opacity: 1, duration:60}, "<60")
  // introTl.to('.globe-section', {visibility: "hidden", duration:30})
  introTl.from('.globe', {
    scale: 0,
    yPercent:-150,
    duration: 120
    })
  globeTurn = gsap.fromTo('.globe', {
    scrollTrigger: {
      trigger:".globe",
      start: "top top",
      scrub: 10,//move 2s afetr scroll
      end: "+=100%"
    },
  backgroundPosition: "0 0"},
      {backgroundPosition: "830px 0",repeat:-1, duration:120})
// introTl.add(globeTurn, "-=1")
introTl.from('.purple-ring', {
  scale: 0,
  xPercent:100,
  yPercent:-100,
  duration: 120
 })
 introTl.from('.blue-ring', {
  scale: 0,
  xPercent:-100,
  yPercent:100,
  duration: 120
 }, "<")
 introTl.from(".globe-surround-text", {
  duration: 120,
  attr: { startOffset: "0%" },
  opacity: 0,
  // ease: "power1.inOut"
}, "<");
introTl.from('.left-ring-text, .right-ring-text', {
  opacity: 0,
})
introTl.from('.purple-ring div, .blue-ring div', {
  opacity: 0
})
//child2 count
let newValOne = document.getElementById('globe-count-1').innerHTML;
let newValTwo = document.getElementById('globe-count-2').innerHTML;
var Cont={val:0}; //, NewVal = 100 ;

// TweenLite.to(Cont,5,{val:NewVal,roundProps:"val",onUpdate:function(){
//   document.getElementById("counter").innerHTML=Cont.val
// }});
introTl.to(Cont,{
  duration:60,
  val:newValOne,roundProps:"val",onUpdate:function(){
  document.getElementById("globe-count-1").innerHTML=Cont.val
}});
introTl.to(Cont,{
  duration:60,
  val:newValTwo,roundProps:"val",onUpdate:function(){
  document.getElementById("globe-count-2").innerHTML=Cont.val
}}, "<1");
//child1 count
introTl.from('.continent', {
  opacity: 0,
  scale: 0,
  duration: 120
})
introTl.from('.continent-text', {
  opacity: 0,
})
introTl.to('.continent', {
  xPercent:80,
  // rotateY: 180,
  duration: 120
})
introTl.to('.continent', {
  delay: 120,
  opacity: 0,
  scale: 0,
  duration: 120
})
introTl.to('.globe-score-wrap, .earth-container', {
  yPercent: -200,
  duration: 120,
})
// introTl.to('.globe', {
//   backgroundColor: "#00000000", duration:1, 
// }, "-=3")


// //WATCH SECTION
// let productTl = gsap.timeline({
//   scrollTrigger: {
//     trigger:".watch-section",
//     start: "top top",
//     scrub: true,//move 2s afetr scroll
//     pin: true,
//     // end: "bottom top",
//     end: "+=100%",
//     onEnter: () => namePage('.watch-section', '#ffffff'),
//     onEnterBack: () => namePage('.watch-section', '#ffffff'),
//     pinSpacing: false,
//   }
// })
// productTl.from('#btm-wtch-1', {
//   // delay:120,
//   yPercent: 50,
//   scale: 0.7,
//   duration:360,
//   // ease: Power1.easeOut
// })
// productTl.to('#btm-wtch-1', {
//   yPercent: -50,
//   scale: 2.5,
//   duration:360,
//   // ease: Power1.easeOut
// }, "-=1")
// productTl.from('#acc-btn1', {
//   opacity:0
// })
// productTl.from('.gradient-ball', {
//   scale: 0,
//   duration:380,
// })
// productTl.to('#btm-wtch-1', {
//   yPercent: 0,
//   scale: 1,
//   duration:360,
// }, "<")

// productTl.from('.product-text', {
//   opacity: 0,
//   duration:30,
// })
// // productTl.to('.watch-section', {
// //   zIndex: 2,
// //   yPercent: 0,
// // })
// // productTl.to('.phone-section, #btm-wtch-2, #acc-btn2', {
// //   opacity: 0
// // }, "<")
// // productTl.to('.phone-section', {
// //   yPercent: 0,
// // }, "+=2")
// productTl.to('.gradient-ball', {
//   opacity: 0,
//   duration:380,
// })
// // productTl.to('.watch-section', {
// //   opacity: 0,
// //   // display: "none",
// // })
// // productTl.to('.phone-section, #acc-btn2', {
// //   opacity: 1,
// // }, "<")
// productTl.to('.watch-section', {
//   autoAlpha: 0, duration:0.1
// })

// //PHONE SECTION
// let phoneTl = gsap.timeline({
//   overwrite: true,
//   scrollTrigger: {
//     trigger:".phone-section",
//     start: "top top",
//     scrub: true,//move 10s afetr scroll
//     pin: true,
//     end: "+=100%",
//     onEnter: () => namePage('.phone-section', '#ffffff'),
//     onEnterBack: () => namePage('.phone-section', '#ffffff'),
//     pinSpacing: false,
//   }
// })
// phoneTl.to('.phone-section', {
//   autoAlpha: 1, duration:0.1
// })
// phoneTl.to('#btm-wtch-2 img, #acc-btn2', {
//   opacity:1
// })
// phoneTl.to('#btm-wtch-2', {
//   yPercent:-250, duration:360,
//   scale: 0.7, opacity:1
// })
// phoneTl.from('.large-circle', {
//   opacity:0, duration:360,
//   // overwrite: true,
// }, "<1")

// phoneTl.from('#phone-wrapper', {
//   x:-500, duration:360
// }, "<")

// phoneTl.from('.text-area', {
//   opacity:0, duration:360, onComplete: startScroll
// }, "-=1")
// // phoneTl.to('#acc-btn2', {
// //   xPercent: 50,
// //   duration:360
// // })
// phoneTl.to('.phone-section', {
//   autoAlpha: 0, duration:0.8
// })

//   // //PHONE On SCROLL

// const screenCanvas = document.getElementById("phone-div");
// const screenContext = screenCanvas.getContext("2d");
// // phoneCanvas.width = 1100;
// // phoneCanvas.height = 770;
// screenCanvas.width = 1920;
// screenCanvas.height = 1080;
// // console.log(screenCanvas.width,screenCanvas.height)
// // var canvas = ctx.canvas ;
//   //  var hRatio = screenCanvas.width  / screenImages[allScreens.frame].width    ;
//   //  var vRatio =  screenCanvas.height / screenImages[allScreens.frame].height  ;
//   //  var ratio  = Math.min ( hRatio, vRatio );
//   //  var centerShift_x = ( screenCanvas.width - screenImages[allScreens.frame].width*ratio ) / 2;
//   //  var centerShift_y = ( screenCanvas.height - screenImages[allScreens.frame].height*ratio ) / 2;  
//   //  screenContext.clearRect(0,0,screenCanvas.width, screenCanvas.height);
// //    ctx.drawImage(img, 0,0, img.width, img.height,
// //                       centerShift_x,centerShift_y,img.width*ratio, img.height*ratio);  

// // const phoneCount = 31;
// const screenCount = 628;
// // const currentPhone = index => (
// //   `IMG/phone/S1 screen scroll_Aug 31_${(index).toString().padStart(4, '0')}.png`
// // );
// const currentScreen = index => (
//   `phones/phone and screen_${(index).toString().padStart(5, '0')}.png`
// );
// // const phoneImages = []
// const screenImages = []
// // const allPhones = {
// //   frame: 0
// // };
// const allScreens = {
//   frame: 0
// };

// // for (let i = 0; i < phoneCount; i++) {
// //   const img = new Image();
// //   img.src = currentPhone(i);
// //   phoneImages.push(img);
// // }
// for (let i = 0; i < screenCount; i++) {
//   const img = new Image();
//   img.src = currentScreen(i);
//   screenImages.push(img);
// }
// let phoneScroll = gsap.timeline({
//   scrollTrigger: {
//     trigger:".phone-section",
//     start: "top top",
//     scrub: true,//move in line with scroll
//     pin: true
    
//   },
// })
// phoneScroll
// // .to(allPhones,{
// //   frame: phoneCount-1,
// //   snap: "frame",
// //   duration: 60,
// //   onUpdate: renderPhone
// // })
// .to(allScreens, {
//   frame: screenCount-1,
//   snap: "frame",
//   duration:60,
//   delay:120,
//   onUpdate: renderScreen
// });
// // console.log(phoneImages.length)
// // phoneImages[0].onload = renderPhone;
// screenImages[0].onload = renderScreen;
// // function renderPhone() {
// //   phoneContext.clearRect(0, 0, phoneCanvas.width, phoneCanvas.height);
// //   phoneContext.drawImage(phoneImages[allPhones.frame], 0, 0); 
// // }
// function renderScreen() {
//   screenContext.clearRect(0,0,screenCanvas.width, screenCanvas.height);
//   screenContext.drawImage(screenImages[allScreens.frame], 0, 0, screenImages[allScreens.frame].width,    screenImages[allScreens.frame].height,     // source rectangle
//     0, 0, screenCanvas.width, screenCanvas.height); // destination rectangle
// }

// phoneScroll.pause()
// function startScroll(){
//   phoneScroll.restart()
// }
// function pauseScroll(){
//   phoneScroll.pause()
// }
// function resumeScroll(){
//   phoneScroll.resume()
// }
// let signUpTl = gsap.timeline({
//   overwrite: 'auto',
//   scrollTrigger: {
//     trigger:".access-form",
//     start: "top+=100px",
//     scrub: true,//move in line with scroll
//     pin: true,
//     end: "+=100%",
//     // pinSpacing: false,
//     onEnter: () => namePage('.access-form', '#5c5cf2'),
//     onEnterBack: () => namePage('.access-form', '#5c5cf2'),
    
//   },
// })
// signUpTl.to('.access-form', {
//   autoAlpha: 1, duration:0.8
// })
// signUpTl.from('#acc-btn3', {
//   xPercent:50,
//   duration:120
// })
// signUpTl.from('.form-box', {
//   opacity: 0, duration:60
// })
// signUpTl.from('.watch-box', {
//   scale: 0, duration:120
// }, "-=30")

</script>